<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>席予約</title>
    <script type="text/javascript">
        
      // 座席データ trueであれば空、falseであれば指定済 
      // seats[x][y]でx行yカラム目を指定 
      var seats = [[ false, true, false, true, true, true, false, true, false ],
                   [ false, true, false, false, true, false, true, true, true ],
                   [ true, true, true, true, true, true, false, true, false ],
                   [ true, true, true, false, true, false, false, true, false ]];

      function initSeats() {
        // HTML内の「img id="seat0" src=""」のsrcに値を設定
        for (var i = 0; i < seats.length; i++) { // seatsは４行なのでseats.lengthは4になる。
          for (var j = 0; j < seats[i].length; j++) { // seats[i].lengthはi行目のカラム数（9）
            if (seats[i][j]) {
              // シートに空きがある場合の処理
              // document.getElementById("seat" + (i * seats[i].length + j)).src = "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_avail.png";
              setSeat(i * seats[i].length + j, "avail");
            }
            else {
              // シートが埋まっている場合の処理
              // document.getElementById("seat" + (i * seats[i].length + j)).src = "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_unavail.png";
              setSeat(i * seats[i].length + j, "unavail");
            }
          }
        }
      }

      function findSeats() {
        var finished = 0; // 予約が終了したかどうかを示すフラグ 0:未終了
        // ３つ連続して空いている席を探す
        var i = 0; 
        while (i < seats.length && finished == 0) { // 座席の最後まで探す
          for (var j = 0; j < seats[i].length - 2; j++) {
            // 現在の席とその次からの２つの座席が空いているかチェック
            if (seats[i][j] && seats[i][j + 1] && seats[i][j + 2]) {
              // 空いているので、席を予約するか確認？
              var accept = confirm((i + 1)+"列の" + (j + 1) + "番から" + (j + 3) +
                "番があいています。予約しますか？");
              if (accept) {
                // ユーザがアクセプトしたら終わり（breakを実行しループから抜ける）。
                finished = 1;
                seats[i][j]=seats[i][j + 1]=seats[i][j + 2]=false; //予約済にする
                // document.getElementById("seat" + (i * seats[i].length + j)).src = "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_select.png";
                // document.getElementById("seat" + (i * seats[i].length + j + 1)).src = "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_select.png";
                // document.getElementById("seat" + (i * seats[i].length + j + 2)).src = "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_select.png";
                setSeat(i * seats[i].length + j, "select");
                setSeat(i * seats[i].length + j + 1, "select");
                setSeat(i * seats[i].length + j + 2, "select");
                break;
                  } // if (accept)
              } // if
            } // for
          // 外側のループのカウンタをインクリメント（次の行へ移る）
          i++;
        } // while
      }

      function setSeat(seatNum, status) {
        document.getElementById("seat" + seatNum).src = "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_" + status + ".png";
      }

      function getSheetStatus(t){
        console.log(t.src)
        if(t.src == "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_select.png"){
          return "あなたの予約席です";
        } else if(t.src == "https://www.yama.info.waseda.ac.jp/~yamana/LECTURE/CSWP/seat_avail.png"){
          return "空いています";
        }else{
          return "他の方が予約済みです"
        }
      }

      function showSheetStatus(sheetNum){
        alert("この席は、" + getSheetStatus(sheetNum));
      }
    </script>
  </head>

  <body onload="initSeats();">
    <div style="margin-top:25px; text-align:center">
      <img id="seat0" src="" onclick="showSheetStatus(this)" />
      <img id="seat1" src="" onclick="showSheetStatus(this)" />
      <img id="seat2" src="" onclick="showSheetStatus(this)" />
      <img id="seat3" src="" onclick="showSheetStatus(this)" />
      <img id="seat4" src="" onclick="showSheetStatus(this)" />
      <img id="seat5" src="" onclick="showSheetStatus(this)" />
      <img id="seat6" src="" onclick="showSheetStatus(this)" />
      <img id="seat7" src="" onclick="showSheetStatus(this)" />
      <img id="seat8" src="" onclick="showSheetStatus(this)" /><br />
      <img id="seat9" src="" onclick="showSheetStatus(this)" />
      <img id="seat10" src="" onclick="showSheetStatus(this)" />
      <img id="seat11" src="" onclick="showSheetStatus(this)" />
      <img id="seat12" src="" onclick="showSheetStatus(this)" />
      <img id="seat13" src="" onclick="showSheetStatus(this)" />
      <img id="seat14" src="" onclick="showSheetStatus(this)" />
      <img id="seat15" src="" onclick="showSheetStatus(this)" />
      <img id="seat16" src="" onclick="showSheetStatus(this)" />
      <img id="seat17" src="" onclick="showSheetStatus(this)" /><br />
      <img id="seat18" src="" onclick="showSheetStatus(this)" />
      <img id="seat19" src="" onclick="showSheetStatus(this)" />
      <img id="seat20" src="" onclick="showSheetStatus(this)" />
      <img id="seat21" src="" onclick="showSheetStatus(this)" />
      <img id="seat22" src="" onclick="showSheetStatus(this)" />
      <img id="seat23" src="" onclick="showSheetStatus(this)" />
      <img id="seat24" src="" onclick="showSheetStatus(this)" />
      <img id="seat25" src="" onclick="showSheetStatus(this)" />
      <img id="seat26" src="" onclick="showSheetStatus(this)" /><br />
      <img id="seat27" src="" onclick="showSheetStatus(this)" />
      <img id="seat28" src="" onclick="showSheetStatus(this)" />
      <img id="seat29" src="" onclick="showSheetStatus(this)" />
      <img id="seat30" src="" onclick="showSheetStatus(this)" />
      <img id="seat31" src="" onclick="showSheetStatus(this)" />
      <img id="seat32" src="" onclick="showSheetStatus(this)" />
      <img id="seat33" src="" onclick="showSheetStatus(this)" />
      <img id="seat34" src="" onclick="showSheetStatus(this)" />
      <img id="seat35" src="" onclick="showSheetStatus(this)" /><br />
      <input type="button" id="findseats" value="Find Seats" onclick="findSeats();" />
    </div>
  </body>
</html>
